@model List<DeerManager.Models.Vaccinations>

@{
    ViewBag.Title = "Vacs";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}


<style>
* {
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

/* Style the header */
header {
  background-color: #666;
  padding: 30px;
  text-align: center;
  font-size: 35px;
  color: white;
}

/* Create two columns/boxes that floats next to each other */
nav {
  float: left;
  width: 30%;
  height: 300px; /* only for demonstration, should be removed */
  background: #ccc;
  padding: 20px;
}

/* Style the list inside the menu */
nav ul {
  list-style-type: none;
  padding: 0;
}

article {
  float: left;
  padding: 20px;
  width: 70%;
  background-color: #f1f1f1;
  height: 300px; /* only for demonstration, should be removed */
}

/* Clear floats after the columns */
section::after {
  content: "";
  display: table;
  clear: both;
}

/* Style the footer */
footer {
  background-color: #777;
  padding: 10px;
  text-align: center;
  color: white;
}

/* Responsive layout - makes the two columns/boxes stack on top of each other instead of next to each other, on small screens */
@@media (max-width: 600px) {
  nav, article {
    width: 100%;
    height: auto;
  }
}
</style>

<div style="text-align:right;">
    <a class="btn btn-primary" style="margin-bottom:10px" onclick="alert('הוסף')"><i class="fa fa-plus"></i> הוסף חיסון לקבוצה </a>
    <a class="btn btn-danger" style="margin-bottom:10px" onclick="alert('מחק')"><i class="icon-remove"></i>  מחק חיסון עבור קבוצה  </a>
</div>
<h2 style="text-align:center;">חיסונים קרובים</h2>

<!-- Normal -->
<link href="//cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" rel="stylesheet" />


<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>

<script src="https://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>

<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />


@* Normal *@
<script src="//cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>


@*<script src="~/Scripts/bootstrap.min.js"></script>*@

@*For the add new sheep*@

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />


@using (Html.BeginForm())
{
<body>

        <div style="text-align:center;">
            <select name="test_redirect" onchange="Display(this.options[this.selectedIndex].value)">
                <option value="0">-- בחר קבוצה  --</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="8">9</option>
                <option value="8">10</option>
            </select>
        </div>
        <section>
            <div style="text-align:center;">
                @for (int i = 0; i < Model.Count; i++)
                {

                    <div style="color:red;">ת"ז</div>
                    @Model[i].Id
                    <br />
                    <div style="color:red;">  תרופה </div>
                    @Model[i].Medicine
                    <br />
                    <div style="color:red;">תאריך חיסון </div>
                    @Model[i].DateOfVaccination
                    <br />
                    <div style="color:red;">  תאריך חיסון הבא </div>
                    @Model[i].NextVaccinationDate
                    <br />
                    if (Model.Count > 1)
                    {
                        <h2>-----------------</h2>
                    }
                }
                @if (Model.Count < 1)
                {
                    <h2 style="color:red;">אין חיסונים קרובים</h2>
                }
            </div>
        </section>

        <table id="sheeps" class="display select" cellspacing="0" width="100%" style="text-align:center;">
            <thead>
                <tr>
                    <th><input name="select_all" value="1" type="checkbox"></th>
                    <th>תעודת זהות</th>
                    <th>מספר הכבש</th>
                    <th>סוג הדם</th>
                    <th>מין</th>
                    <th>קבוצה</th>
                    <th>תאריך לידה</th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th></th>
                    <th>תעודת זהות</th>
                    <th>מספר הכבש</th>
                    <th>סוג הדם</th>
                    <th>מין</th>
                    <th>קבוצה</th>
                    <th>תאריך לידה</th>
                </tr>
            </tfoot>
        </table>
</body>
}




<script>
        //
    // Updates "Select all" control in a data table
    //
    function updateDataTableSelectAllCtrl(table) {
        var $table = table.table().node();
        var $chkbox_all = $('tbody input[type="checkbox"]', $table);
        var $chkbox_checked = $('tbody input[type="checkbox"]:checked', $table);
        var chkbox_select_all = $('thead input[name="select_all"]', $table).get(0);

        // If none of the checkboxes are checked
        if ($chkbox_checked.length === 0) {
            chkbox_select_all.checked = false;
            if ('indeterminate' in chkbox_select_all) {
                chkbox_select_all.indeterminate = false;
            }
            // If all of the checkboxes are checked
        } else if ($chkbox_checked.length === $chkbox_all.length) {
            chkbox_select_all.checked = true;
            if ('indeterminate' in chkbox_select_all) {
                chkbox_select_all.indeterminate = false;
            }
            // If some of the checkboxes are checked
        } else {
            chkbox_select_all.checked = true;
            if ('indeterminate' in chkbox_select_all) {
                chkbox_select_all.indeterminate = true;
            }
        }
    }
    function Display(id) {
        alert('you selected' + id)
        var table = $('#sheeps').DataTable();
        table.destroy();
        // Array holding selected row IDs
        var rows_selected = [];
        var urls = '@Url.Action("GetListByGroup", "Home")/' + id;
        var table = $('#sheeps').DataTable({
            'ajax': {
                "url": urls,
                "type": "GET",
                "daModelatype": "json"
            },
            "columns": [
                {
                    "data": "Id", "render": function (data) {

                        return '<input type="checkbox" name="chkbox">';
                    },
                    "orderable": false,
                    "searchable": false,
                    "width": "150px"
                },
                { "data": "Id" },
                { "data": "SheepNum" },
                { "data": "Blood" },
                { "data": "Gender" },
                { "data": "Group" },
                { "data": "Birthday" }
            ],

            "processing": true,
            "language": {
                processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">טוען...</span> ',
                "search": "חיפוש",
                "emptyTable": "אין כבשים בקבצוה שבחרת"
            },
            'order': [[1, 'asc']],
            'rowCallback': function (row, data, dataIndex) {
                // Get row ID
                var rowId = data[0];

                // If row ID is in the list of selected row IDs
                if ($.inArray(rowId, rows_selected) !== -1) {
                    $(row).find('input[type="checkbox"]').prop('checked', true);
                    $(row).addClass('selected');
                }
            },
        });
        // Handle click on checkbox
        $('#sheeps tbody').on('click', 'input[type="checkbox"]', function (e) {
            var $row = $(this).closest('tr');

            // Get row data
            var data = table.row($row).data();

            // Get row ID
            var rowId = data[0];

            // Determine whether row ID is in the list of selected row IDs
            var index = $.inArray(rowId, rows_selected);

            // If checkbox is checked and row ID is not in list of selected row IDs
            if (this.checked && index === -1) {
                rows_selected.push(rowId);

                // Otherwise, if checkbox is not checked and row ID is in list of selected row IDs
            } else if (!this.checked && index !== -1) {
                rows_selected.splice(index, 1);
            }

            if (this.checked) {
                $row.addClass('selected');
            } else {
                $row.removeClass('selected');
            }

            // Update state of "Select all" control
            updateDataTableSelectAllCtrl(table);

            // Prevent click event from propagating to parent
            e.stopPropagation();
        });

        // Handle click on table cells with checkboxes
        $('#sheeps').on('click', 'tbody td, thead th:first-child', function (e) {
            $(this).parent().find('input[type="checkbox"]').trigger('click');
        });

        // Handle click on "Select all" control
        $('thead input[name="select_all"]', table.table().container()).on('click', function (e) {
            if (this.checked) {
                $('#sheeps tbody input[type="checkbox"]:not(:checked)').trigger('click');
            } else {
                $('#sheeps tbody input[type="checkbox"]:checked').trigger('click');
            }
            // Prevent click event from propagating to parent
            e.stopPropagation();
        });

        // Handle table draw event
        table.on('draw', function () {
            // Update state of "Select all" control
            updateDataTableSelectAllCtrl(table);
        });

        // Handle form submission event
        $('#frm-sheeps').on('submit', function (e) {
            var form = this;
            // Iterate over all selected checkboxes
            $.each(rows_selected, function (index, rowId) {
                // Create a hidden element
                $(form).append(
                    $('<input>')
                        .attr('type', 'hidden')
                        .attr('name', 'id[]')
                        .val(rowId)
                );
            });
        });
    }
    function PopupForm(url) {
        var formDiv = $('<div/>');
        $.get(url)
            .done(function (response) {
                formDiv.html(response);
                Popup = formDiv.dialog({
                    autoOpen: true,
                    resizable: true,
                    title: 'חיסונים',
                    height: 450,
                    width: 600,
                    close: function () {
                        Popup.dialog('destroy').remove();
                    }
                });
            });
    }
    function SubmitForm(form) {
        $.validator.unobtrusive.parse(form);
        if ($(form).valid()) {
            $.ajax({
                type: "POST",
                url: form.action,
                data: $(form).serialize(),
                success: function (data) {
                    if (data.success) {
                        Popup.dialog('close');
                        dataTable.ajax.reload();
                        $.notify(data.message, {
                            globalPosition: "top center",
                            className: "success"
                        })
                    }
                }
            });
        }
        return false;
    }
</script>
